# FuckBilibiliComments 

一个强大的B站评论爬取与分析工具，支持多种爬取模式和智能数据处理。

## 📋 基础Q&A

### 这个脚本能做什么？

**FuckBilibiliComments** 是一个专业的B站评论数据采集与分析工具，具备以下核心功能：

- **多模式评论爬取**：基于用户提供的BV号或者链接，识别视频并爬取评论，可以爬取充电视频评论，也可以爬取“楼中楼”评论，<u>**单次爬取上限在15000条左右**</u>；暂不支持爬取动态或者番剧的评论（欢迎大佬基于此进行二次开发）

  *（这时候你可能想问，为什么评论爬取存在上限？别着急，继续往下看）*

- **智能去重处理**：自动识别并处理重复评论，只保留爬取时间最新的评论

- **基础数据分析能力**：按分钟/小时/日/月/年进行评论数据统计，且可生成评论趋势折线图

### 你需要准备什么？

**系统要求：**

- 安装有Python 3.7 或更高版本

  *怎么装Python？自己找教程（无慈悲）*

  

**依赖库：**

**脚本具备自动检测和安装缺失依赖的功能**，首次运行时会自动安装或更新相关依赖。

特别地，遇到某些情况需要手动安装依赖时，请输入以下命令：

```bash
pip install requests>=2.25.0 pandas>=1.3.0 matplotlib>=3.3.0
```

**所需参数：**

- 用来爬取的账号的cookie和user_agent
- B站视频链接若干



## 🚀 快速上手

### 项目结构

```
FuckBilibiliComments/
├── FuckBilibiliComments.py        # 主程序文件
├── B站评论CSV去重工具.py          # CSV文件去重处理工具
├── 评论时间精细统计工具.py         # 评论时间精细统计分析工具
├── config.json                    # 主配置文件
├── requirements.txt               # 依赖列表
├── README.md                      # 项目文档
├── config/                        # 配置文件目录
│   ├── 大号/
│   ├── 小号/
│   └── 小小号/
└── 技术文档/                       # 技术文档目录
    ├── Analysis_Summary.md
    ├── Code_Structure_Analysis.md
    ├── Script_Usage_Scenarios.md
    └── ...
```

### 基本使用

#### 主程序使用

1. **克隆项目**
```bash
git clone <repository-url>
cd FuckBilibiliComments
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置Cookie**
编辑 `config.json` 文件，添加你的B站Cookie：
```json
{
    "cookie": "your_bilibili_cookie_here"
}
```

4. **运行脚本**
```bash
python FuckBilibiliComments.py
```

#### 独立工具使用

##### B站评论CSV去重工具

**功能说明**：
- 对CSV评论数据文件进行去重处理
- 支持多种去重策略（保留最早/最晚评论）
- 自动备份原文件，生成去重后的新文件
- 提供详细的去重统计报告

**使用方法**：
```bash
python B站评论CSV去重工具.py
```

**交互流程**：
1. 输入CSV文件路径
2. 选择去重策略（保留最早或最晚评论）
3. 确认处理，查看去重结果

##### 评论时间精细统计工具

**功能说明**：
- 对评论数据进行精细时间统计分析
- 支持小时级和分钟级统计粒度
- 自动识别视频发布时间或支持用户自定义时间范围
- 生成统计报告和趋势图表
- 图表标题包含视频发布时间信息

**使用方法**：
```bash
python 评论时间精细统计工具.py
```

**交互流程**：
1. 输入CSV评论数据文件路径
2. 输入对应的TXT统计报告文件路径（用于提取视频发布时间）
3. 选择统计时间段：
   - 基于视频发布时间的相对统计
   - 用户自定义绝对时间范围
4. 选择统计粒度（小时/分钟）
5. 查看生成的统计报告和趋势图表

**输出文件**：
- `*_小时统计报告.txt` - 小时级统计数据
- `*_分钟统计报告.txt` - 分钟级统计数据
- `*_小时统计图.png` - 小时级趋势图
- `*_分钟统计图.png` - 分钟级趋势图

## 项目之外·如我所书



此处记录了一些鄙人的碎碎念，也比较大的主观性，希望您不会因此受到冒犯，或者因为对鄙人立场的鄙夷而放弃使用该脚本。

### 输入格式支持

脚本支持多种视频标识符输入格式：
- BV号：`BV1234567890`
- AV号：`av123456` 或 `AV123456`
- 完整URL：`https://www.bilibili.com/video/BV1234567890`
- 移动端URL：`https://m.bilibili.com/video/BV1234567890`
- 带参数URL：`https://www.bilibili.com/video/BV1234567890?p=1&t=123`

## 🔧 原理说明

### 核心工作流程

1. **输入解析**：智能识别并转换各种格式的视频标识符
2. **视频信息获取**：通过B站API获取视频基本信息
3. **评论数据爬取**：
   - 热度排序爬取：获取高热度评论
   - 时间排序爬取：获取最新评论
   - 迭代去重：实时处理重复数据
4. **数据处理**：
   - 合并不同排序方式的数据
   - 智能去重算法处理
   - 数据格式标准化
5. **统计分析**：
   - 按时间粒度统计评论数量
   - 生成可视化图表
   - 输出详细统计报告

### 技术特点

- **智能Cookie管理**：自动检测Cookie状态，支持多账号配置
- **异常处理机制**：完善的错误处理和恢复机制
- **内存优化**：大数据量处理时的内存管理优化
- **并发控制**：合理的请求频率控制避免被封

## 🏗️ 模块结构与决策逻辑树

### 主要模块结构

```
核心模块架构
├── 输入处理模块
│   ├── BV/AV号转换
│   ├── URL解析
│   └── 视频信息获取
├── 爬取引擎模块
│   ├── 热度排序爬取
│   ├── 时间排序爬取
│   └── 迭代去重处理
├── 数据处理模块
│   ├── CSV数据合并
│   ├── 重复数据检测
│   └── 数据清洗
├── 统计分析模块
│   ├── 时间粒度分析
│   ├── 趋势图生成
│   └── 统计报告输出
└── 配置管理模块
    ├── Cookie管理
    ├── 日志配置
    └── 输出路径管理
```

### 决策逻辑树

```
程序启动
├── 检查配置文件
│   ├── 存在 → 加载配置
│   └── 不存在 → 创建默认配置
├── 检查依赖
│   ├── 完整 → 继续执行
│   └── 缺失 → 自动安装
├── 模式选择
│   ├── 测试模式 → 使用预设视频进行测试
│   ├── 迭代模式 → 实时去重爬取
│   └── 综合模式 → 完整数据处理流程
├── 视频输入处理
│   ├── 格式识别 → BV/AV/URL转换
│   ├── 视频信息获取 → API调用
│   └── 有效性验证 → 错误处理
├── 评论爬取执行
│   ├── 热度排序爬取
│   ├── 时间排序爬取
│   └── 数据实时处理
├── 数据后处理
│   ├── 合并去重
│   ├── 格式标准化
│   └── 文件输出
└── 统计分析
    ├── 时间粒度判断
    ├── 统计数据生成
    └── 可视化图表输出
```

### 输出文件结构

**迭代模式输出：**
```
评论爬取_视频标题_BV号_时间戳/
├── logs/                      # 日志文件
├── 原始数据/                   # 原始CSV数据
├── 按时间统计/                 # 时间统计结果
├── 统计数据.txt               # 汇总统计
└── 按热度排序.csv             # 热度排序结果
```

**综合模式输出：**
```
评论爬取_视频标题_BV号_时间戳/
├── logs/                      # 详细日志
├── 原始数据/
│   ├── 热度爬取原始数据/
│   ├── 时间爬取原始数据/
│   └── 合并去重结果.csv
├── 按时间统计/
│   ├── 按小时统计.txt
│   ├── 按日统计.txt
│   └── 趋势图.png
└── 最终处理结果/
```

## 🔬 高级Q&A



### Q: Cookie失效怎么办？
A: 脚本具备自动Cookie状态检测功能，当检测到412错误（Cookie被封禁）时，会自动清理临时文件并提示用户更新Cookie。支持多账号配置切换。

### Q: 如何自定义爬取参数？
A: 可以通过修改 `config.json` 文件来调整：
- 请求间隔时间
- 最大重试次数
- 输出文件路径
- 日志级别等

### Q: 如何处理反爬虫机制？
A: 脚本内置多重反反爬策略：
- 智能请求频率控制
- User-Agent轮换
- 请求头随机化
- 异常重试机制
- Cookie状态监控

### Q: 数据准确性如何保证？
A: 通过多重验证机制确保数据质量：
- 重复数据智能识别
- 数据完整性校验
- 异常数据过滤
- 详细日志记录便于审计

### Q: 如何进行批量处理？
A: 可以通过以下方式实现批量处理：
1. 修改脚本支持视频列表输入
2. 使用shell脚本循环调用
3. 利用测试模式进行批量验证

### Q: 输出数据如何进一步分析？
A: 输出的CSV文件包含完整的评论元数据，支持：
- 导入Excel进行透视表分析
- 使用pandas进行数据科学分析
- 导入数据库进行SQL查询
- 结合其他可视化工具生成报表

## 📞 其他补充

### 联系方式

如果您在使用过程中遇到问题或有改进建议，欢迎通过以下方式联系：

- **GitHub Issues**: 在项目仓库中提交Issue
- **技术交流**: 欢迎Fork项目并提交Pull Request
- **问题反馈**: 请详细描述问题现象和复现步骤

### 贡献指南

我们欢迎社区贡献！如果您想为项目做出贡献：

1. Fork 本仓库
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

### 常见问题排查

1. **依赖安装失败**：检查Python版本和网络连接
2. **Cookie无效**：重新获取B站Cookie并更新配置
3. **内存不足**：调整批处理大小或使用迭代模式
4. **网络超时**：检查网络连接或调整超时设置

## 📄 项目许可证

本项目采用 **CC BY-NC 4.0**（知识共享署名-非商业性使用 4.0 国际许可协议）进行许可。

### 许可证要点：

✅ **允许的使用方式：**
- 个人学习和研究使用
- 非商业性质的数据分析
- 学术研究和教育用途
- 开源项目集成（需保持相同许可证）

❌ **禁止的使用方式：**
- 商业用途或盈利性使用
- 未经授权的商业数据服务
- 违反B站服务条款的使用

📋 **使用要求：**
- 使用时必须署名原作者
- 保留许可证声明
- 说明是否对原作品进行了修改

### 免责声明

本工具仅供学习和研究使用，使用者应当：
- 遵守相关法律法规
- 尊重B站的服务条款
- 合理使用，避免对服务器造成过大负担
- 不得将爬取的数据用于商业用途

**本项目旨在开源探讨，使用本工具所产生的任何法律责任由使用者自行承担。**

